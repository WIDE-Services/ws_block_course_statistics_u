{{!
This file is part of Moodle - http://moodle.org/

Moodle is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Moodle is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

@package    block_course_statistics
@copyright  2023 onwards WIDE Services {@link https://www.wideservices.gr}
@license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later

@template block_event_management/measurespertool/usersmain
@description This template displays user-specific statistics for activity engagement within courses.
It expects the following context data:
- access: Boolean indicating if the user has permission to access this page.
- usersdata: Array containing statistics for each user and their interaction with specific activities, with each element including:
  - lastname: The last name of the user.
  - firstname: The first name of the user.
  - coursetitle: The title of the course.
  - activity: The name of the activity the user interacted with.
  - activitytime: Formatted total time the user dedicated to the activity.
  - numactivitytime: Numeric total time for sorting purposes.
  - activitysessions: The total number of sessions spent by the user on the activity.
  - avgtimesession: Formatted average time spent per session on the activity.
  - numavgtimesession: Numeric average time per session for sorting.
  - avgusesession: The average number of times the user engaged with the activity during sessions.
  - paramcourseid: The course ID used for URL parameters.
  - bcmbcourses: URL for the breadcrumb link back to the courses overview.
  - bcmbactivities: URL for the breadcrumb link back to the activities overview.
- current_lang: The current language code for localization.
- js: Boolean indicating if JavaScript should be included for DataTable functionality.
}}

{{#access}}
    <div class="page-wrapper">

        <!-- PAGE CONTENT-->
        <div class="page-content--bgf7">

            <!-- STATISTIC MENU-->
            {{> block_course_statistics/admin/common/navsection }}
            <!-- END STATISTIC MENU -->

            <!-- Filter Table Form -->
            {{> block_course_statistics/admin/common/formsection }}
            <!-- END Filter Table Form -->

            <!-- DATA TABLE-->
            <section class="p-t-20">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <h3 class="title-5 m-b-35">{{#str}}measurespertool, block_course_statistics{{/str}}</h3>

                            <!-- Breadcrumb -->
                            <nav>
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{{bcmbcourses}}">{{#str}}courses, block_course_statistics{{/str}}</a></li>
                                    <li class="breadcrumb-item"><a href="{{bcmbactivities}}&courseid={{paramcourseid}}">{{#str}}activities, block_course_statistics{{/str}}</a></li>
                                    <li class="breadcrumb-item"><a href="#">{{#str}}users, block_course_statistics{{/str}}</a></li>
                                </ol>
                            </nav>
                            <!-- END Breadcrumb -->

                            <div class="table-responsive table-responsive-data2">
                                <br>
                                <table class="statistics display table table-data2" cellspacing="0" width="100%">
                                    <thead>

                                    <tr>
                                        <th></th>
                                        <th>{{#str}}lastname{{/str}}</th>
                                        <th>{{#str}}firstname{{/str}}</th>
                                        <th>{{#str}}course{{/str}}</th>
                                        <th>{{#str}}activity{{/str}}</th>
                                        <th>{{#str}}totaltimededicated, block_course_statistics{{/str}}</th>
                                        <th>{{#str}}numberofsessions, block_course_statistics{{/str}}</th>
                                        <th>{{#str}}avgactivitytime, block_course_statistics{{/str}}</th>
                                        <th>{{#str}}averageusedinsessions, block_course_statistics{{/str}}</th>
                                    </tr>

                                    </thead>

                                    <tbody>

                                    {{#usersdata}}

                                        <tr class="tr-shadow">
                                            <td></td>
                                            <td>{{lastname}}</td>
                                            <td>{{firstname}}</td>
                                            <td>{{coursetitle}}</td>
                                            <td>{{activity}}</td>
                                            <td data-order="{{numactivitytime}}"><span class="hidden-span">{{numactivitytime}}</span>{{activitytime}}</td>
                                            <td>{{activitysessions}}</td>
                                            <td data-order="{{numavgtimesession}}"><span class="hidden-span">{{numavgtimesession}}</span>{{avgtimesession}}</td>
                                            <td>{{avgusesession}}</td>
                                        </tr>

                                    {{/usersdata}}

                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- END DATA TABLE-->
        </div>

    </div>
{{/access}}
{{^access}}

    <div class="container">

        <div class="jumbotron bg-danger">
            <h1>{{#str}}accessdenied, block_course_statistics{{/str}}</h1>
        </div>

    </div>

{{/access}}
<!-- end document-->

{{#js}}

    var tableconfig = {
    order: [
    [5, 'desc']
    ]
    };

    // Get the current language from Moodle's global configuration.
    var lang = '{{current_lang}}';

    // Check if the language is not the English one ('en').
    if (lang !== 'en') {
    // Remove anything after '_' and remove '_' itself if 'el_wp' is found.
    var langToLoad = lang.indexOf('_wp') !== -1 ? lang.substring(0, lang.indexOf('_wp')).replace('_', '') : lang;

    // If the language is any other language, set the language option for DataTable.
    tableconfig.language = {
    url: M.cfg.wwwroot + '/blocks/course_statistics/lang/' + langToLoad + '/' + langToLoad + '.json'
    };
    }

    require(
    ['block_course_statistics/datatables_init-lazy',
    'block_course_statistics/jszip-lazy',
    'block_course_statistics/pause_measure-lazy'
    ], function(dataTableModule, Jszip, Main) {
    dataTableModule.initializeDataTable(tableconfig);
    window.JSZip = Jszip;
    Main.pausemeasure();
    });

{{/js}}
